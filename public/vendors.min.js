"use strict";function _defineProperty(t,e,a){return e in t?Object.defineProperty(t,e,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[e]=a,t}function _toConsumableArray(t){if(Array.isArray(t)){for(var e=0,a=Array(t.length);e<t.length;e++)a[e]=t[e];return a}return Array.from(t)}function _classCallCheck(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}function enableTabs(t){for(var e=document.getElementById(t).getElementsByTagName("a"),a=0;a<e.length;a++)new Tab(e[a])}var _createClass=function(){function i(t,e){for(var a=0;a<e.length;a++){var i=e[a];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(t,i.key,i)}}return function(t,e,a){return e&&i(t.prototype,e),a&&i(t,a),t}}(),_jscallog=function(t){},_jsCalWrapper={instances:{}},_a=function(t,e,a){var i=document.createElement(t);return i.className=e||"",a&&a.appendChild(i),i},JSCalendarEvent=function(){function i(t,e,a){if(_classCallCheck(this,i),!t)return!1;this.setData(t),this.setID(t.id),this.position=a,this.options=e.options,this.calendar=e,this.buildElements(),this.updateElements(),this.bindEvents()}return _createClass(i,[{key:"setID",value:function(t){this.id=t}},{key:"getID",value:function(){return this.id}},{key:"setData",value:function(t){this.at=t.at&&new Date(t.at),this.duration=t.duration,this.displayname=t.displayname,this.color=t.color,this.html=t.html}},{key:"formatDuration",value:function(t){var e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:"",a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"";if(!t)return"";t=Math.floor(t/1e3/60);var i=Math.floor(t/60),s=t%60;return e+(i?i+"h ":"")+(s?s+"mins":"")+a}},{key:"formatTime",value:function(t){var e=t.getHours(),a=t.getMinutes(),i=t.getSeconds(),s="";return this.options.ampm&&(11<e?(e-=12==e?0:12,s=" PM"):s=" AM"),e+(a<10?":0":":")+a+(this.displaySeconds?(i<10?":0":":")+i:"")+s}},{key:"buildElements",value:function(){this.monthElem=_a("div","cell-event-mark"),this.weekElem=_a("div","cal-week-day-event-col"),this.dayElem=_a("div","cal-total-day-event-view")}},{key:"updateElements",value:function(){var t=this.monthElem,e=this.weekElem,a=this.dayElem;if(this.at){var i=this.formatTime(new Date(this.at));t.textContent=i,t.dataset.at=this.at}if(this.displayname){var s=this.displayname.substring(0,this.options.titleCropSize);t.textContent+=(this.at?" - ":"")+s+(s.length!=this.displayname?"...":"")}if(t.style.background=this.color||this.options.eventBackground,this.displayname?(e.classList.add("text-injected"),e.textContent=this.displayname):this.html?(e.innerHTML=this.html,e.classList.add("html-injected")):(e.classList.add("not-injected"),e.textContent=this.options.nonameEventVocab),e.style.background=this.color||this.options.eventBackground,!this.at&&e.classList.add("no-starting-time"),!this.duration&&e.classList.add("no-duration"),this.at){var n=void 0;if(n=this.formatTime(this.at),this.duration){var o=new Date(this.at.getTime()+this.duration);n+=" - "+this.formatTime(o)}(e.querySelector(".cal-week-day-time-float")||_a("span","cal-week-day-time-float",e)).textContent=n}var r=this.options.dayviewGapMinutes,h=60/r;(this.gapcell=-1,this.at?this.gapcell=this.at.getHours()*h+this.at.getMinutes()/r:a.classList.add("no-time"),this.gapcount=this.options.dayviewNoTimeGapSize,this.duration?this.gapcount=Math.ceil(this.duration/1e3/60/r):a.classList.add("no-duration"),a.style.background=this.color||this.options.eventBackground,a.style.height=this.gapcount*this.options.dayviewGapHeight-2+"px",this.at&&(this.daytop=this.gapcell*this.options.dayviewGapHeight,a.style.top=this.daytop+"px",a.style.right="0px",a.style.left="0px",a.style.zIndex=Math.floor(this.gapcell)),(a.querySelector(".cal-total-day-displayname")||_a("div","cal-total-day-displayname",a)).textContent=this.displayname||this.options.nonameEventVocab,this.at)&&((a.querySelector(".cal-total-day-time")||_a("div","cal-total-day-time",a)).textContent=this.formatTime(new Date(this.at))+this.formatDuration(this.duration,", "))}},{key:"getDayGap",value:function(){return this.gapcell}},{key:"dragging",value:function(){this.monthElem.classList.add("dragged"),this.weekElem.classList.add("dragged"),this.dayElem.classList.add("dragged"),this.calendar.dragging(this)}},{key:"dropped",value:function(){this.monthElem.classList.remove("dragged"),this.weekElem.classList.remove("dragged"),this.dayElem.classList.remove("dragged"),this.calendar.dropped(this)}},{key:"bindEvents",value:function(){var e=this;this.monthElem.addEventListener("mousedown",function(){window.addEventListener("mouseup",function t(){window.removeEventListener("mouseup",t),e.dropped()}),e.dragging()}),this.weekElem.addEventListener("mousedown",function(){window.addEventListener("mouseup",function t(){window.removeEventListener("mouseup",t),e.dropped()}),e.dragging()}),this.dayElem.addEventListener("mousedown",function(t){window.addEventListener("mouseup",function t(){window.removeEventListener("mouseup",t),e.dropped()}),e.originalY=t.y,e.potentialnewtop=e.daytop,e.dragging()}),this.monthElem.addEventListener("click",function(){e.calendar.fire("click",e)}),this.weekElem.addEventListener("click",function(){e.calendar.fire("click",e)})}},{key:"render",value:function(t,e){e.appendChild(this[t+"Elem"])}},{key:"destroy",value:function(){this.monthElem&&this.monthElem.remove(),this.weekElem&&this.weekElem.remove(),this.dayElem&&this.dayElem.remove(),this.monthElem=void 0,this.weekElem=void 0,this.dayElem=void 0}}]),i}(),JSCalendar=function(){function y(t,e){if(_classCallCheck(this,y),this.elem=t,this.id=t.id,this.options=Object.assign(y.defaultOptions,e||{defaultOptions:!0}),this.state=y.createState(),this.hooks={},Math.floor(60/this.options.dayviewGapMinutes)!=60/this.options.dayviewGapMinutes)throw new Error("Option dayviewGapMinutes must be a divisor of 60");this.fire("new")}return _createClass(y,[{key:"init",value:function(t){return _jscallog("Created new instance with id : "+this.id),this.fire("init"),this.createStructure(),this.options.datasource?this.fetch(t):this.render()}},{key:"createStructure",value:function(){var s=this;y.emptyElem(this.elem),this.elem.classList.add("js-calendar"),this.controlbar=_a("div","control-bar",this.elem),this.tablewrapper=_a("div","calendar-wrapper",this.elem),this.table=_a("table","calendar-table",this.tablewrapper),this.viewcontroller=_a("div","control-bar-widget control-bar-views",this.controlbar),this.actioncontroller=_a("div","control-bar-widget control-bar-actions",this.controlbar),this.titlecontroller=_a("div","control-bar-widget control-bar-title",this.controlbar),this.options.views.forEach(function(t){var e=s.options.viewsVocab[t]||t,a=_a("button","control-button change-view change-view-"+t,s.viewcontroller);a.addEventListener("click",function(){s.setView(t)}),a.textContent=e}),this.options.buttons.forEach(function(t){var e=s.options.buttonsVocab[t]||t,a=_a("button","control-button calendar-action calendar-action-"+t,s.actioncontroller),i=s.options.buttonsActions[t];a.addEventListener("click",function(){"function"==typeof i?i(s):s[i]()}),a.textContent=e})}},{key:"goNow",value:function(){var t=new Date;return this.state.year=t.getFullYear(),this.state.month=t.getMonth(),this.state.day=t.getDate(),this.state.weekday=t.getDay(),this.adjustDateToView(),this.render()}},{key:"goBack",value:function(){if("day"==this.state.view){if(this.state.day--,0==this.state.day){this.state.month--,0==this.state.month&&(this.state.month=11,this.state.year--);var t=y.getDaysInMonth(this.state.year,this.state.month);this.state.day=t.numberOfDays}}else if("month"==this.state.view)this.state.month--,this.state.month<0&&(this.state.month=11,this.state.year--);else if("week"==this.state.view&&(this.state.day-=7,this.state.day=this.state.day-this.state.day%7,this.state.day<=0)){this.state.month--,-1==this.state.month&&(this.state.month=11,this.state.year--);var e=y.getDaysInMonth(this.state.year,this.state.month);this.state.day=e.numberOfDays+this.state.day}return this.render()}},{key:"goNext",value:function(){if("day"==this.state.view){var t=y.getDaysInMonth(this.state.year,this.state.month);this.state.day++,this.state.day>t.numberOfDays&&(this.state.day=1,this.state.month++,11<this.state.month&&(this.state.month=0,this.state.year++))}else if("month"==this.state.view)this.state.month++,11<this.state.month&&(this.state.month=0,this.state.year++);else if("week"==this.state.view){var e=y.getDaysInMonth(this.state.year,this.state.month);this.state.day+=7,this.state.day>e.numberOfDays&&(this.state.month++,12==this.state.month&&(this.state.month=0,this.state.year++),this.state.day=this.state.day-e.numberOfDays)}return this.render()}},{key:"goToDay",value:function(t){var e=t.split("-");e=new Date(e[0],e[1],e[2]),this.state.year=e.getFullYear(),this.state.month=e.getMonth(),this.state.day=e.getDate(),this.setView("day")}},{key:"push",value:function(t){if(this.fire("willPush",t),t.at){var e=new Date(t.at);this.validateCell(e.getFullYear(),e.getMonth(),e.getDate()),this.state.matrix[e.getFullYear()][e.getMonth()][e.getDate()].push(new JSCalendarEvent(t.event,this,e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate())),this.fire("pushed",t)}else this.fire("didNotPush",t);return this}},{key:"on",value:function(t,e){return this.hooks[t]=this.hooks[t]||[],this.hooks[t].push(e),this}},{key:"fire",value:function(t,e){var a=this;return _jscallog("Firing event '"+t+"'"),y.fire(t,this,e),(this.hooks[t]||[]).forEach(function(t){t(a,e)}),this}},{key:"destroy",value:function(){for(var t in this.state.matrix)for(var e in this.state.matrix[t])for(var a in this.state.matrix[t][e])for(var i=0;i<this.state.matrix[t][e][a].length;i++)this.state.matrix[t][e][a][i].destroy();return delete this.elem,delete this.tablewrapper,delete this.controlbar,delete this.table,delete _jsCalWrapper[this.id],this}},{key:"adjustDateToView",value:function(){"week"==this.state.view&&this.state.weekday!=this.state.day&&this.state.day<8&&(this.state.month--,this.state.day=y.getDaysInMonth(this.state.year,this.state.month).numberOfDays)}},{key:"getDateAppendee",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.state.day;return 3<t&&t<21?this.options.nthVocab.default:this.options.nthVocab[t.toString().slice(-1)]||this.options.nthVocab.default}},{key:"setView",value:function(t){return this.fire("viewWillChange"),this.state.view!=t&&(this.state.view=t,this.adjustDateToView(),this.render(),this.fire("viewChanged")),this}},{key:"render",value:function(){var t=this;this.fire("willRender"),_jscallog("Rendering instance "+this.id);var e=Date.now();return this.fetch(function(){switch(y.emptyElem(t.table),t.state.view){case"day":t.renderDay();break;case"week":t.renderWeek();break;case"month":default:t.renderMonth()}t.updateControls(),t.fire("rendered"),_jscallog("Rendering benchmark : "+(Date.now()-e)+"ms")},this.options.alwaysFetch),this}},{key:"renderDay",value:function(){var s=this;this.titlecontroller.textContent=this.options.monthsVocab[this.state.month]+" "+this.state.day+this.getDateAppendee()+", "+this.state.year;var t=_a("tr","cal-week-day-row",this.table),e=_a("td","cal-week-day-col",t);this.validateCell();var a=this.state.matrix[this.state.year][this.state.month][this.state.day],i=_a("div","single-day-no-time-wrap",e),n=_a("div","single-day-time-table",e),o=_a("div","cal-total-day-event-wrap",n);a.filter(function(t){return!t.at}).forEach(function(t){t.render(s.state.view,i)}),o.addEventListener("mousemove",function(t){if(s.state.dragging){var e=s.state.dragged.daytop-(s.state.dragged.originalY-t.y);s.state.dragged.dayElem.style.top=e+"px",s.state.dragged.potentialnewtop=e}});for(var r=this.options.dayviewGapMinutes,h=Math.ceil(60/r),l=0,d=0;d<24;d++)for(var c=0;c<h;c++){var u=_a("div","hour-block gap-"+ ++l,n),m=_a("span","minutes-block-time",u);u.classList.add(0==c?"hour-gap":"minutes-gap");var y=c*r,v=d,g="";u.style.height=this.options.dayviewGapHeight-1+"px",this.options.ampm&&(d<12?g="AM":(v-=12==v?0:12,g="PM")),m.textContent=v+":"+(y<10?"0":"")+y+g,u.dataset.gapindex=l}var p={},f=-1;a.filter(function(t){return t.at}).forEach(function(t){t.render(s.state.view,o),t.ratio=100,t.dayElem.style.left="0",t.dayElem.style.right="0";var e=t.gapcount;Math.floor(t.gapcell)!=t.gapcell&&e++;for(var a=0;a<e;a++){var i=Math.floor(t.gapcell+a);p[i]||(p[i]=[]),p[i].push(t)}(-1==f||f>t.gapcell)&&(f=t.gapcell)});var w=function(t){var i=p[t].length,s=100/i,n=0;p[t].forEach(function(t){var e=n*s,a=s*(i-n-1);s<t.ratio&&(t.ratio=s,t.dayElem.style.left=e+"%",t.dayElem.style.right=a+"%"),n++})};for(var k in p)w(k);this.state.skipscroll?this.state.skipscroll=!1:this.tablewrapper.scrollTop=f*this.options.dayviewGapHeight}},{key:"renderWeek",value:function(){var c=this,t=_a("tr","cal-week-day-row",this.table),u=_a("td","cal-week-day-col",t),e=(y.getDaysInMonth(this.state.year,this.state.month),new Date(this.state.year,this.state.month,this.state.day)),a=new Date(e.getTime()-864e5*e.getDay()),i=new Date(a.getTime()+5184e5);this.validateCell(a.getFullYear(),a.getMonth(),a.getDate()),this.validateCell(i.getFullYear(),i.getMonth(),i.getDate()),_jscallog("Rending matrix week");for(var m=new Date(a.getTime()),s=function(t){var e=m.getFullYear(),a=m.getMonth(),i=m.getDate(),s=m.getDay(),n=m.getTime(),o=_a("div","cal-week-day-sep",u);o.textContent=c.options.daysVocab[s]+", "+c.options.monthsVocab[a]+" "+i;var r=_a("div","col-week-day-container",u);if(c.state.matrix[e][a][i])for(var h=c.state.matrix[e][a][i],l=0;l<h.length;l++){h[l].render(c.state.view,r)}var d=e+"-"+a+"-"+i;r.dataset.fulldate=d,r.dataset.at=m.getTime(),r.addEventListener("mouseenter",function(){c.state.dragging&&(r.appendChild(c.state.dragged.weekElem),c.state.newPosition=d,c.state.newAt=m.getTime())}),o.addEventListener("click",function(){c.goToDay(d)}),_a("div","cal-week-day-no-event-col",r).textContent=c.options.emptyDayVocab,m=new Date(n+864e5)},n=0;n<7;n++)s();var o=this.getDateAppendee(a.getDate()),r=this.getDateAppendee(i.getDate());a.getMonth()==i.getMonth()?this.titlecontroller.textContent=this.options.monthsVocab[a.getMonth()]+" "+a.getDate()+o+" - "+i.getDate()+r+", "+this.state.year:a.getYear()==i.getYear()?this.titlecontroller.textContent=this.options.monthsVocab[a.getMonth()]+" "+a.getDate()+o+" - "+this.options.monthsVocab[i.getMonth()]+" "+i.getDate()+r+", "+this.state.year:this.titlecontroller.textContent=this.options.monthsVocab[a.getMonth()]+" "+a.getDate()+o+", "+a.getFullYear()+" - "+this.options.monthsVocab[i.getMonth()]+" "+i.getDate()+r+", "+i.getFullYear()}},{key:"renderMonth",value:function(){for(var r=this,t=y.getDaysInMonth(this.state.year,this.state.month),h=-t.firstDay,l=t.numberOfDays,e=new Date,d=e.getMonth()==this.state.month&&e.getFullYear()==this.state.year,c=e.getDate(),a=_a("tr","jscal-weekday-row",this.table),i=0;i<this.options.daysVocab.length;i++){_a("td","js-cal-weekday",a).textContent=this.options.daysVocab[i]}for(var u=0;u<6;u++)for(var m=_a("tr","jscal-row row"+u,this.table),s=function(t){var e=new Date(r.state.year,r.state.month,++h),a=_a("td","jscal-col row"+u+"col"+t,m),i=_a("span","cell-number",a);if(h<=0||l<h){a.classList.add("notinmonth"),i.textContent=e.getDate()}else i.classList.add("not-in-month"),i.textContent=e.getDate();d&&c==h&&a.classList.add("cell-today"),m.appendChild(a),r.validateCell(e.getFullYear(),e.getMonth(),e.getDate());var s=r.state.matrix[e.getFullYear()][e.getMonth()][e.getDate()];if(s)for(var n=0;n<s.length;n++)s[n].render(r.state.view,a);var o=e.getFullYear()+"-"+e.getMonth()+"-"+e.getDate();a.dataset.at=e.getTime(),a.dataset.fulldate=o,a.addEventListener("mouseenter",function(){r.state.dragging&&(a.appendChild(r.state.dragged.monthElem),r.state.newPosition=a.dataset.fulldate,r.state.newAt=a.dataset.at)}),i.addEventListener("click",function(){r.goToDay(o)})},n=0;n<7;n++)s(n);this.titlecontroller.textContent=this.options.monthsVocab[this.state.month]+" "+this.state.year}},{key:"updateControls",value:function(){var t=this.controlbar.querySelector(".active");t&&t.classList.remove("active");var e=this.controlbar.querySelector(".change-view-"+this.state.view);e&&e.classList.add("active")}},{key:"setDate",value:function(t,e,a,i){this.state.year=t,this.state.month=e,this.state.day=a,this.state.weekday=new Date(t,e,a).getDay(),i&&this.render()}},{key:"validateCell",value:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:this.state.year,e=1<arguments.length&&void 0!==arguments[1]?arguments[1]:this.state.month,a=2<arguments.length&&void 0!==arguments[2]?arguments[2]:this.state.day;this.state.matrix[t]||(this.state.matrix[t]={0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),this.state.matrix[t][e]||(this.state.matrix[t][e]={}),this.state.matrix[t][e][a]||(this.state.matrix[t][e][a]=[])}},{key:"moveCell",value:function(t){var e=t.position,a=this.state.newPosition;if(!t)return this.fire("cellDidNotMove",{event:t,reason:new Error("moveCell was fired without an event")});if(this.fire("cellMightMove",t),"day"==this.state.view){if(!t.potentialnewtop||t.potentialnewtop==t.daytop)return this.fire("click",t);var i=t.potentialnewtop,s=(i-=i%this.options.dayviewGapHeight)/this.options.dayviewGapHeight;if(s!=t.gapcell){t.gapcell=s,t.dayElem.style.top=i+"px",t.daytop=i;var n=s*this.options.dayviewGapMinutes,o=t.at;t.at=new Date(this.state.year,this.state.month,this.state.day,0,n),t.updateElements(),this.fire("cellMoved",{event:t,oldtime:o,newtime:t.at}),this.state.skipscroll=!0,this.render()}else t.dayElem.style.top=i+"px",this.fire("cellDidNotMove",{event:t,reason:new Error("Distance between click and drop not big enough")})}else if(a&&a!=e){this.fire("cellWillMove",{event:t,oldPosition:e,newPosition:a});var r=e.split("-"),h=a.split("-"),l=this.state.matrix[r[0]][r[1]][r[2]],d=l?l.indexOf(t):-1,c=new Date(t.at);if(c.setDate(h[2]),c.setMonth(h[1]),c.setFullYear(h[0]),t.at=c,-1!=d){l.splice(d,1),this.validateCell(h[0],h[1],h[2]);var u=this.state.matrix[h[0]][h[1]][h[2]];u=u||[],(this.state.matrix[h[0]][h[1]][h[2]]=u).push(t),t.position=a,this.fire("cellMoved",{event:t,oldPosition:e,newPosition:a,newtime:t.at})}else this.fire("cellDidNotMove",{event:t,reason:new Error("Could not find cell in matrix")})}else this.fire("cellDidNotMove",{event:t,reason:new Error("Position did not change")})}},{key:"dragging",value:function(t){this.fire("dragging",t),this.state.dragging=!0,this.state.dragged=t,this.state.newPosition=void 0,this.elem.classList.add("dragging")}},{key:"dropped",value:function(t){this.fire("dropped",t),this.moveCell(t),this.state.dragging=!1,this.state.dragged=void 0,this.elem.classList.remove("dragging")}},{key:"appendMatrix",value:function(n,t){var o=this;this.fire("matrixWillAppend");var r=this.state.matrix,e=function(s){r[s]||(r[s]={0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}});var t=n[s],e=function(a){var t=n[s][a],e=function(e){var t;r[s][a][e]||(r[s][a][e]=[]),(t=r[s][a][e]).push.apply(t,_toConsumableArray(n[s][a][e].map(function(t){return new JSCalendarEvent(t,o,s+"-"+a+"-"+e)})))};for(var i in t)e(i)};for(var a in t)e(a)};for(var a in n)e(a);return this.fire("matrixAppended"),t&&this.render(),this}},{key:"setMatrix",value:function(t,e){for(var a in _jscallog("Setting new matrix to instance "+this.id),this.fire("matrixWillSet"),t||(t=y.defaultMatrix()),this.state.matrix=t,this.state.matrix)for(var i in this.state.matrix[a])for(var s in this.state.matrix[a][i])for(var n=0;n<this.state.matrix[a][i][s].length;n++)this.state.matrix[a][i][s][n]=new JSCalendarEvent(this.state.matrix[a][i][s][n],this,a+"-"+i+"-"+s);return _jscallog("No problem setting new matrix to instance "+this.id),this.fire("matrixSet"),this.state.matrixmonth=this.state.month,e&&this.render(),this}},{key:"debug",value:function(){var t={};for(var e in this.state.matrix[this.state.year][this.state.month]){var a=this.state.matrix[this.state.year][this.state.month][e];t[e]=a.map(function(t){return{displayname:t.displayname,at:new Date(t.at),duration:t.duration}})}return{year:this.state.year,month:this.state.month,day:this.state.day,weekday:this.state.weekday,view:this.state.view,monthMatrix:t}}},{key:"fetch",value:function(e,t){var a=this;if(!t&&this.state.matrix[this.state.year]&&this.state.matrix[this.state.year][this.state.month])_jscallog("Loading matrix from local cache"),e&&e();else if(this.options.datasource){var i=new XMLHttpRequest;for(var s in this.options.datasourceHeaders)i.setRequestHeader(s,this.options.datasourceHeaders[s]);var n=y.getDaysInMonth(this.state.year,this.state.month),o=new Date(this.state.year,this.state.month,1),r=new Date(this.state.year,this.state.month,n.numberOfDays),h=o.getTime()-864e5*o.getDay(),l=r.getTime()+864e5*(6-r.getDay())+864e5-1,d=this.options.datasource,c={url:d+=(-1!=d.indexOf("?")?"&":"?")+"year="+this.state.year+"&month="+this.state.month+"&day="+this.state.day+"&view="+this.state.view+"&startstamp="+h+"&endstamp="+l};this.fire("willFetch",c),i.onreadystatechange=function(){if(i.readyState==XMLHttpRequest.DONE&&200==i.status)try{var t=JSON.parse(i.responseText);a.fire("fetched",t),(a.options.fetchReplaces?a.setMatrix(t):a.appendMatrix(t))?(_jscallog("Updated matrix from data source"),e&&e(void 0,t)):(_jscallog("Received invalid matrix"),e&&e(new Error("Invalid matrix size"),t))}catch(t){_jscallog("Caught error during matrix parsing : "+t),e&&e(t)}else i.status&&200!=i.status&&(_jscallog("Received non-200 HTTP response code : "+i.status),e&&e(new Error("Non-200 HTTP response code : "+i.status),i.status))},_jscallog("Sending async request to data source : "+this.options.datasource),i.open("GET",c.url),i.send()}else _jscallog("Created new entry in matrix for "+this.state.year+"/"+this.state.month),this.state.matrix[this.state.year]||(this.state.matrix[this.state.year]={0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),this.state.matrix[this.state.year][this.state.month]||(this.state.matrix[this.state.year][this.state.month]={}),e&&e(new Error("Invalid datasource"));return this}}],[{key:"getDaysInMonth",value:function(t,e){return{numberOfDays:[31,t%4==0&&(t%100!=0||t%400==0)?29:28,31,30,31,30,31,31,30,31,30,31][e],firstDay:new Date(t,e).getDay()}}},{key:"on",value:function(t,e){y.hooks[t]=y.hooks[t]||[],y.hooks[t].push(e)}},{key:"fire",value:function(t,e,a){(y.hooks[t]||[]).forEach(function(t){t(e,a)})}},{key:"emptyElem",value:function(t){if(t)for(;t.firstElementChild;)t.firstElementChild.remove()}},{key:"defaultMatrix",value:function(){var t,e=(new Date).getFullYear();return _defineProperty(t={},e-1,{0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),_defineProperty(t,e,{0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),_defineProperty(t,e+1,{0:{},1:{},2:{},3:{},4:{},5:{},6:{},7:{},8:{},9:{},10:{},11:{}}),t}},{key:"createState",value:function(){var t=new Date;return{view:"month",matrix:y.defaultMatrix(),matrixmonth:t.getMonth(),year:t.getFullYear(),month:t.getMonth(),day:t.getDate(),weekday:t.getDay(),dragging:!1}}},{key:"getInstance",value:function(t){return _jsCalWrapper.instances[t]}},{key:"find",value:function(t){for(var e=(t||document).querySelectorAll(y.defaultOptions.globalSelector),a=0;a<e.length;a++){var i=e[a],s=i.id||"js-calendar-"+a;_jsCalWrapper.instances[s]=new y(i).init()}return y}},{key:"defaultOptions",get:function(){return{views:["day","week","month"],viewsVocab:{day:"Day",week:"Week",month:"Month"},buttons:["previous","today","next"],buttonsActions:{previous:"goBack",today:"goNow",next:"goNext"},buttonsVocab:{previous:"<",today:"Today",next:">"},monthsVocab:["January","February","March","April","May","June","July","August","September","October","November","December"],daysVocab:["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"],nthVocab:{1:"st",2:"nd",3:"rd",default:"th"},emptyDayVocab:"Nothing here.",noDate:"Somewhen",nonameEventVocab:"Event without a name",globalSelector:".js-calendar",eventBackground:"rgb(126, 156, 193)",titleCropSize:20,dayviewGapMinutes:30,dayviewNoTimeGapSize:2,dayviewGapHeight:38,datasource:"",datasourceHeaders:{},ampm:!0,displaySeconds:!1,alwaysFetch:!1,fetchReplaces:!1}}}]),y}();JSCalendar.hooks={},"/programs/human-wellness"===window.location.pathname?enableTabs("HWTabs"):"/programs/seasonal"===window.location.pathname?enableTabs("SeasonsTabs"):"/get-involved/opportunities"===window.location.pathname&&enableTabs("OpportunitiesTabs");